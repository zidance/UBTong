!function(e,t){function n(e,t){var i=e,n=t;return s.transform3d?"translate3d("+i+"px, "+n+"px, 0)":"translate("+i+"px, "+n+"px)"}function a(e,t){return s.touch?e.changedTouches[0][t]:e[t]}var i=e.document,s={transform3d:"WebKitCSSMatrix"in e&&"m11"in new WebKitCSSMatrix,touch:"ontouchstart"in e},o=function(){};o.prototype={init:function(e){var t=this,s=e||{},n=i.querySelectorAll(s.elem+" img"),a=i.querySelector(".imgzoom_pack"),o=i.querySelector(".imgzoom_pack .imgzoom_img img"),r=i.querySelector(".imgzoom_pack .imgzoom_x"),h="";t.buffMove=3,t.buffScale=2,t.finger=!1,t._destroy(),r.addEventListener("click",function(){a.style.cssText="display:none",o.src="",o.style.cssText="",t._destroy(),i.removeEventListener("touchmove",t.eventStop,!1)},!1);for(var f=n.length,g=0;f>g;g++)n[g].addEventListener("click",function(){h=this.getAttribute("src"),a.style.cssText="display:block",o.src=h,o.onload=function(){o.style.cssText="margin-top:-"+o.offsetHeight/2+"px",i.addEventListener("touchmove",t.eventStop,!1),t.imgBaseWidth=o.offsetWidth,t.imgBaseHeight=o.offsetHeight,t.addEventStart({wrapX:a.offsetWidth,wrapY:a.offsetHeight,mapX:o.width,mapY:o.height})}},!1)},addEventStart:function(e){var t=this,s=e||{};t.element=i.querySelector(".imgzoom_pack img"),t.wrapX=s.wrapX||0,t.wrapY=s.wrapY||0,t.mapX=s.mapX||0,t.mapY=s.mapY||0,t.outDistY=(t.mapY-t.wrapY)/2,t.width=t.mapX-t.wrapX,t.height=t.mapY-t.wrapY,t.element.addEventListener("touchstart",function(e){t._touchstart(e)},!1),t.element.addEventListener("touchmove",function(e){t._touchmove(e)},!1),t.element.addEventListener("touchend",function(e){t._touchend(e)},!1)},_destroy:function(){this.distX=0,this.distY=0,this.newX=0,this.newY=0},_changeData:function(){this.mapX=this.element.offsetWidth,this.mapY=this.element.offsetHeight,this.width=this.mapX-this.wrapX,this.height=this.mapY-this.wrapY},_touchstart:function(e){var t=this;e.preventDefault();var i=e.targetTouches.length;t._changeData(),1==i?(t.basePageX=a(e,"pageX"),t.basePageY=a(e,"pageY"),t.finger=!1):(t.finger=!0,t.startFingerDist=t.getTouchDist(e).dist,t.startFingerX=t.getTouchDist(e).x,t.startFingerY=t.getTouchDist(e).y),console.log("pageX: "+a(e,"pageX")),console.log("pageY: "+a(e,"pageY"))},_touchmove:function(e){var t=this;e.preventDefault(),e.stopPropagation(),console.log("event.changedTouches[0].pageY: "+event.changedTouches[0].pageY);var i=e.targetTouches.length;1!=i||t.finger||t._move(e),i>=2&&t._zoom(e)},_touchend:function(e){var t=this;t._changeData(),t.finger&&(t.distX=-t.imgNewX,t.distY=-t.imgNewY),t.distX>0?t.newX=0:t.distX<=0&&t.distX>=-t.width?(t.newX=t.distX,t.newY=t.distY):t.distX<-t.width&&(t.newX=-t.width),t.reset()},_move:function(e){var t=this,i=a(e,"pageX"),s=a(e,"pageY");t.distX=i-t.basePageX+t.newX,t.distY=s-t.basePageY+t.newY,t.distX>0?t.moveX=Math.round(t.distX/t.buffMove):t.distX<=0&&t.distX>=-t.width?t.moveX=t.distX:t.distX<-t.width&&(t.moveX=-t.width+Math.round((t.distX+t.width)/t.buffMove)),t.movePos(),t.finger=!1},_zoom:function(e){var t=this,i=t.getTouchDist(e).dist,s=i/t.startFingerDist,n=Math.round(t.mapX*s);Math.round(t.mapY*s);t.imgNewX=Math.round(t.startFingerX*s-t.startFingerX-t.newX*s),t.imgNewY=Math.round((t.startFingerY*s-t.startFingerY)/2-t.newY*s),n>=t.imgBaseWidth?(t.element.style.width=n+"px",t.refresh(-t.imgNewX,-t.imgNewY,"0s","ease"),t.finger=!0):n<t.imgBaseWidth&&(t.element.style.width=t.imgBaseWidth+"px"),t.finger=!0},movePos:function(){var e=this;if(e.height<0)if(e.element.offsetWidth==e.imgBaseWidth)e.moveY=Math.round(e.distY/e.buffMove);else{var t=Math.round((e.element.offsetHeight-e.imgBaseHeight)/2);e.moveY=-t+Math.round((e.distY+t)/e.buffMove)}else{var i=Math.round((e.wrapY-e.imgBaseHeight)/2),s=e.element.offsetHeight-e.wrapY+Math.round(e.wrapY-e.imgBaseHeight)/2;e.distY>=-i?e.moveY=Math.round((e.distY+i)/e.buffMove)-i:e.distY<=-s?e.moveY=Math.round((e.distY+s)/e.buffMove)-s:e.moveY=e.distY}e.refresh(e.moveX,e.moveY,"0s","ease")},reset:function(){var e=this,t=".2s";if(e.height<0)e.newY=-Math.round(e.element.offsetHeight-e.imgBaseHeight)/2;else{var i=Math.round((e.wrapY-e.imgBaseHeight)/2),s=e.element.offsetHeight-e.wrapY+Math.round(e.wrapY-e.imgBaseHeight)/2;e.distY>=-i?e.newY=-i:e.distY<=-s?e.newY=-s:e.newY=e.distY}e.refresh(e.newX,e.newY,t,"ease-in-out")},refresh:function(e,t,i,s){this.element.style.webkitTransitionProperty="-webkit-transform",this.element.style.webkitTransitionDuration=i,this.element.style.webkitTransitionTimingFunction=s,this.element.style.webkitTransform=n(e,t)},getTouchDist:function(e){var t=0,s=0,n=0,a=0,o=0,r=0,h={};return t=e.touches[0].pageX,n=e.touches[1].pageX,s=e.touches[0].pageY-i.body.scrollTop,a=e.touches[1].pageY-i.body.scrollTop,t&&n?(o=n>=t?(n-t)/2+t:(t-n)/2+n,r=a>=s?(a-s)/2+s:(s-a)/2+a,h={dist:Math.round(Math.sqrt(Math.pow(t-n,2)+Math.pow(s-a,2))),x:Math.round(o),y:Math.round(r)}):void 0},eventStop:function(e){e.preventDefault(),e.stopPropagation()}},e.ImagesZoom=new o}(this);
