!function(e){function i(t){var n=[["resolve","done",e.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",e.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",e.Callbacks({memory:1})]],r="pending",a={state:function(){return r},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var t=arguments;return i(function(i){e.each(n,function(n,r){var o=e.isFunction(t[n])&&t[n];s[r[1]](function(){var t=o&&o.apply(this,arguments);if(t&&e.isFunction(t.promise))t.promise().done(i.resolve).fail(i.reject).progress(i.notify);else{var n=this===a?i.promise():this,s=o?[t]:arguments;i[r[0]+"With"](n,s)}})}),t=null}).promise()},promise:function(t){return null!=t?e.extend(t,a):a}},s={};return e.each(n,function(e,t){var i=t[2],o=t[3];a[t[1]]=i.add,o&&i.add(function(){r=o},n[1^e][2].disable,n[2][2].lock),s[t[0]]=function(){return s[t[0]+"With"](this===s?a:this,arguments),this},s[t[0]+"With"]=i.fireWith}),a.promise(s),t&&t.call(s,s),s}var t=Array.prototype.slice;e.when=function(n){var u,c,f,r=t.call(arguments),a=r.length,s=0,o=1!==a||n&&e.isFunction(n.promise)?a:0,l=1===o?n:i(),d=function(e,i,n){return function(r){i[e]=this,n[e]=arguments.length>1?t.call(arguments):r,n===u?l.notifyWith(i,n):--o||l.resolveWith(i,n)}};if(a>1)for(u=new Array(a),c=new Array(a),f=new Array(a);a>s;++s)r[s]&&e.isFunction(r[s].promise)?r[s].promise().done(d(s,f,r)).fail(l.reject).progress(d(s,c,u)):--o;return o||l.resolveWith(f,r),l.promise()},e.Deferred=i}(Zepto);